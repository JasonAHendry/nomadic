{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Overview","text":""},{"location":"#overview","title":"Overview","text":"<p>Nomadic is a real-time bioinformatics pipeline and dashboard for nanopore sequencing data. While sequencing is still ongoing, it performs read mapping and sample quality control, as well as variant calling and annotation. This information is displayed in real-time to a graphical dashboard that has interactive features.</p> <p> </p> <p>It was designed to work with amplicon sequencing data from the NOMADS-MVP protocol, which targets a panel of genes important for the control of Plasmodium falciparum malaria (see Basic Usage). However, it was coded flexibly and works with other organisms or amplicon panels (see Advanced Usage).</p> <p></p> <p> </p> <p></p>"},{"location":"#features","title":"Features","text":"<ul> <li> Real-time read mapping with Minimap2.</li> <li> Real-time sample quality control and amplicon coverage evaluation.</li> <li> Real-time variant calling with bcftools. These calls are preleiminary; treat with caution.</li> <li> Support for different reference genomes or amplicons panels.</li> </ul>"},{"location":"#resources","title":"Resources","text":"<ul> <li>The NOMADS-MVP protocol is available in English and French.</li> <li>Read our preprint here.</li> </ul>"},{"location":"#acknowledgements","title":"Acknowledgements","text":"<p>This work was funded by the Bill and Melinda Gates Foundation (INV-003660, INV-048316).</p>"},{"location":"advanced/","title":"Advanced Usage","text":"<p>We will populate this page with more details soon. But for now, we would direct advanced users to the Nomadic github and the help text of individual commands for advanced information about Nomadic.</p> <p>For a quick reference, here is the help for <code>nomadic realtime</code></p> <pre><code>Usage: nomadic realtime [OPTIONS] EXPERIMENT_NAME\n\n  Analyse data being produced by MinKNOW while sequencing is ongoing\n\nOptions:\n  -w, --workspace DIRECTORY       Path of the workspace where all input/output\n                                  files (beds, metadata, results) are stored.\n                                  The workspace directory simplifies the use\n                                  of nomadic in that many arguments don't need\n                                  to be listed as they are predefined in the\n                                  workspace config or can be loaded from the\n                                  workspace  [default: (current directory)]\n   TEXT\n  -o, --output PATH               Path to the output directory where results\n                                  of this experiment will be stored. Usually\n                                  the default of storing it in the workspace\n                                  should be enough.  [default:\n                                  (&lt;workspace&gt;/results/&lt;experiment_name&gt;)]\n  -f, --fastq_dir DIRECTORY       Path to `fastq_pass` directory produced by\n                                  MinKNOW or Guppy.  [default: (/var/lib/minkn\n                                  ow/data/&lt;experiment_name&gt;/fastq_pass)]\n  -m, --metadata_csv FILE         Path to metadata CSV file containing barcode\n                                  and sample information.  [default: (&lt;workspa\n                                  ce&gt;/metadata/&lt;experiment_name&gt;.csv)]\n  -b, --region_bed PATH           Path to BED file specifying genomic regions\n                                  of interest or name of panel, e.g. 'nomads8'\n                                  or 'nomadsMVP'.  [required]\n  -r, --reference_name [Pf3D7|PfDd2|Pv|Poc|Pm|AgPEST|AaDONGOLA2021|AcolN3|AfunGA1|AsUCISS2018|Hs]\n                                  Choose a reference genome to be used in\n                                  real-time analysis.\n  -c, --call                      Perform preliminary variant calling of\n                                  biallelic SNPs in real-time.\n  --resume                        Resume a previous experiment run if the\n                                  output directory already exists. Only use if\n                                  you want to force resuming an already\n                                  started experiment. Not needed in\n                                  interactive mode as this will be prompted\n  -v, --verbose                   Increase logging verbosity. Helpful for\n                                  debugging.\n  --help                          Show this message and exit.\n</code></pre> <p>You can see that almost all inputs to the software can be specified explicitly (instead of using the default behaviour). For example, to use your own amplicon panel with P. falciparum malaria, you just need to specify the path to it using the <code>-b</code> flag.</p>"},{"location":"basic/","title":"Basic Usage","text":""},{"location":"basic/#quick-summary","title":"Quick summary","text":"<p>To run Nomadic, open a terminal window and type the following:</p> <pre><code>conda activate nomadic\ncd &lt;path/to/your/workspace&gt;\nnomadic realtime &lt;expt_name&gt;\n</code></pre> <ul> <li><code>&lt;path/to/your/workspace&gt;</code> should be replaced with the path to your Nomadic workspace.</li> <li><code>&lt;expt_name&gt;</code> should be replaced with the name of your experiment.<ul> <li>You should have given your experiment the same name in MinKNOW.</li> <li>You should have given your metadata file this name, and put it in your workspace metadata folder (<code>&lt;path/to/your/workspace&gt;/metadata/&lt;expt_name&gt;.csv</code>).</li> </ul> </li> </ul> <p>The dashboard will open in a browser window on your computer. </p>"},{"location":"basic/#detailed-instructions","title":"Detailed instructions","text":""},{"location":"basic/#before-starting","title":"Before starting","text":"<p>Before starting make sure you have installed Nomadic (see Installation). </p> <p>Then, open a terminal window and activate the Nomadic environment:</p> <pre><code>conda activate nomadic\n</code></pre>"},{"location":"basic/#starting-a-workspace","title":"Starting a workspace","text":"<p>Nomadic creates workspaces to help organise your input data and analysis results. A workspace is just a folder on your computer where all of the input data needed to run Nomadic, as well as your analysis results, are stored. You can create a workspace with the following command:</p> <pre><code>nomadic start pfalciparum\n</code></pre> <p>By default the name of the new workspace is <code>nomadic</code>. You can enter the workspace by typing:</p> <pre><code>cd nomadic\n</code></pre> <p>Inside of the workspace, you should see the following folders:</p> Folder Contents <code>beds</code> Contains information about amplicons used in sequencing. <code>metadata</code> Where you should put all of your metadata files. <code>results</code> Where the results from running Nomadic will go. Initially it will be empty."},{"location":"basic/#using-nomadic-for-real-time-analysis","title":"Using Nomadic for real-time analysis","text":"<p>Nomadic can process nanopore squencing data being produced by MinKNOW in real-time. To do so, follow the steps below.</p> <p>Step 1: Start nanopore sequencing with MinKNOW</p> <p>Use MinKNOW to start nanopore sequencing. Make sure to take note of the experiment name, you will need this in later steps.</p> <p>Step 2: Create a metadata file</p> <p>Create a metadata file containing information about what barcodes you have used and their associated sample IDs. Here is an example:</p> <p></p> <p>Only the <code>barcode</code> and <code>sample_id</code> columns are mandatory. The rest are optional, and you are also free to include any other columns you like.</p> <p>Move your metadata file into the metadata folder of your Nomadic workspace, and give it the same experiment name you used with MinKNOW (<code>&lt;path/to/your/workspace&gt;/metadata/&lt;expt_name&gt;.csv</code>).</p> <p>Step 3: Run</p> <p>Open a terminal window and start the nomadic conda environment:</p> <pre><code>conda activate nomadic\n</code></pre> <p>Now navigate to your workspace folder:</p> <pre><code>cd &lt;path/to/your/workspace&gt;\n</code></pre> <p>And launch Nomadic:</p> <pre><code>nomadic realtime &lt;expt_name&gt;\n</code></pre> <p>The dashboard will open in a browser window on your computer. </p>"},{"location":"basic/#using-nomadic-to-view-a-completed-experiment","title":"Using Nomadic to view a completed experiment","text":"<p>Once an experiment is completed, you can still open the Nomadic dashboard to view your results.</p> <p>Step 1. Activate the Nomadic environment.</p> <p>Open a terminal window and activate the Nomadic environment:</p> <pre><code>conda activate nomadic\n</code></pre> <p>Step 2. Navigate in terminal to your workspace.</p> <p>If you created your workspace in your home folder, this will simply be: <pre><code>cd &lt;path/to/your/workspace&gt;\n</code></pre></p> <p>Step 3. Open the dashboard.</p> <p>To open the dashboard of a specific experiment, you only need to know the experiment name. You can then open the dashboard by running: <pre><code>nomadic dashboard &lt;expt_name&gt;\n</code></pre> Where you should replace <code>&lt;expt_name&gt;</code> with the name of the experiment.</p>"},{"location":"faq/","title":"FAQ","text":"<p>Can I stop and restart <code>nomadic realtime</code>?</p> <p>Yes, you can safely stop and restart <code>nomadic realtime</code>. The program keeps track of what FASTQ files have been processed, and will continue processing from where it left off.</p>"},{"location":"installation/","title":"Installation","text":""},{"location":"installation/#compatibility","title":"Compatibility","text":"<p>Nomadic runs on macOS or Linux. Windows is currently not supported.</p>"},{"location":"installation/#requirements","title":"Requirements","text":"<p>To install Nomadic, you will need to install the package manager conda or mamba. Mamba is faster and is recommended.</p> <p>To install Mamba, run:</p> <pre><code>curl -L -O \"https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-$(uname)-$(uname -m).sh\"\n</code></pre> <p>or</p> <pre><code>wget \"https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-$(uname)-$(uname -m).sh\"\n</code></pre> <p>Then run the script with:</p> <pre><code>bash Miniforge3-$(uname)-$(uname -m).sh\n</code></pre>"},{"location":"installation/#steps","title":"Steps","text":"<p>Open a terminal window and type:</p> <pre><code>conda create -c bioconda -n nomadic nomadic\n</code></pre> <p>Or, if you are using Mamba:</p> <pre><code>mambda create -c bioconda -n nomadic nomadic\n</code></pre> <p>Nomadic should now be installed in it's own conda environment.</p>"},{"location":"installation/#test-installation","title":"Test installation","text":"<p>To test the installation, we will enter the conda environment:</p> <pre><code>conda activate nomadic\n</code></pre> <p>Then type:</p> <pre><code>nomadic --help\n</code></pre> <p>If <code>nomadic</code> has been installed successfully, you should see a set of available commands:</p> <pre><code>Usage: nomadic [OPTIONS] COMMAND [ARGS]...\n\n  Mobile sequencing and analysis in real-time\n\nOptions:\n  --version  Show the version and exit.\n  --help     Show this message and exit.\n\nCommands:\n  start      Start a workspace.\n  download   Download reference genomes.\n  realtime   Run analysis in real-time.\n  dashboard  Just run the dashboard.\n</code></pre>"},{"location":"installation/#update-nomadic","title":"Update nomadic","text":"<p>To update Nomadic to the newest version, activate your conda environment:</p> <pre><code>conda activate nomadic\n</code></pre> <p>Then type:</p> <pre><code>conda update nomadic\n</code></pre> <p>to update Nomadic.</p> <p>You can check your installed version with</p> <pre><code>nomadic --version\n</code></pre>"},{"location":"output_files/","title":"Output Files & Sharing Data","text":""},{"location":"output_files/#output-files","title":"Output files","text":"<p>Nomadic produces several files that provide information about the quality of your sequencing run, and the variants that were detected. They can be found in the results directory (<code>results/&lt;expt_name&gt;</code>), and are described briefly below:</p>"},{"location":"output_files/#summaryread_mappingcsv","title":"<code>summary.read_mapping.csv</code>","text":"<p>The <code>summary.read_mapping.csv</code> contains information about read mapping for each sample.</p> <p>Each row corresponds to a sample, which can be identified by its barcode (e.g. <code>barcode01</code>). The values provided come from <code>samtools flagstats</code> and are counts of read mapping flags inside of the sample's BAM file. Together they summarise how well your sequencing reads mapped to your reference genome.</p> Column Description <code>barcode</code> Sample barcode. <code>sample_id</code> Sample ID. <code>n_total</code> Total number of read alignments. <code>n_mapped</code> Number of mapped read alignments. <code>n_unmapped</code> Number of unmapped reads. <code>n_primary</code> Number of reads mapping uniquely. <code>n_secondary</code> Number of reads mapping to more than one location. <code>n_supplementary</code> Number of reads mapping as chimeras. <p>For more information about read mapping, please see Understanding the Dashboard.</p>"},{"location":"output_files/#summaryregion_coveragecsv","title":"<code>summary.region_coverage.csv</code>","text":"<p>The <code>summary.region_coverage.csv</code> file contains information about sequencing coverage over each amplicon in each sample.</p> <p>Each row contains information about coverage over a specific amplicon in a specific sample. The sample is indicated by its barcode (e.g. <code>barcode01</code>) and the amplicon is indicated by its <code>name</code> (as well as position and length). The values provided come from <code>samtools bedcov</code>.</p> Column Description <code>barcode</code> Sample barcode. <code>sample_id</code> Sample ID. <code>chrom</code> Chromosome of amplicon. <code>start</code> Start position of amplicon. <code>end</code> End position of amplicon. <code>length</code> Length of amplicon. <code>name</code> Name of amplicon. This comes from the fourth column of BED file used when running <code>nomadic realtime</code> (e.g. <code>-b</code> flag). <code>n_reads</code> Number of reads mapping to the amplicon. <code>mean_cov</code> Mean coverage over the amplicon. <code>cov_gr100</code> Number of positions within the amplicon having &gt;100x coverage. <code>per_cov_gr100</code> Percentage of positions within the amplicon having &gt;100x coverage. <code>total_cov</code> Total coverage over amplicon, i.e. mean coverage times length <p>For more information about region coverage, please see Understanding the Dashboard.</p>"},{"location":"output_files/#summaryvariantscsv","title":"<code>summary.variants.csv</code>","text":"<p>The <code>summary.variants.csv</code>contains preliminary information about the variants identified in each sample.</p> <p>Each row contains information about the genotype, depth, quality, and within-sample allele frequency (WSAF) of a specific single-nucleotide polymorphism (SNP) in a specific sample. For all samples the same set of SNPs are described. The set of SNPs described includes all SNPs where at least one sample carried the alternative allele. Note this file is only generated when the <code>nomadic realtime ... --call</code> flag is used, which is the default.</p> Column Description <code>barcode</code> Sample barcode. <code>sample_id</code> Sample ID. <code>chrom</code> Chromosome of SNP. <code>pos</code> Position of SNP. <code>ref</code> Reference nucleotide for SNP. <code>alt</code> Alternative nucleotide for SNP. <code>qual</code> Variant quality score of SNP. <code>mut_type</code> Type of mutation caused by SNP, e.g. synonymous or non-synonymous. <code>aa_change</code> Amino acid change caused by SNP. For synonymous mutations, we still report (e.g. <code>V380V</code>). <code>aa_pos</code> Amino acid number containing the SNP. <code>strand</code> Strand of gene containing the SNP. <code>amplicon</code> Name of amplicon containing SNP.  This comes from the fourth column of the BED file used when running <code>nomadic realtime</code> (e.g. <code>-b</code> flag). <code>gt</code> Called SNP genotype for the sample. Can be reference (<code>0/0</code>), heterozygous (<code>0/1</code>), homozygous (<code>1/1</code>) or failed QC (<code>./.</code>). Note: these are from <code>bcftools call</code> and assume a diploid genome. <code>gq</code> SNP genotype quality for the sample. Note this is different than variant quality (<code>qual</code>) as it refers to the quality of the genotype call, rather than whether or not the site is variable. <code>dp</code> Sequencing depth over the SNP. Equivalent to coverage. <code>wsaf</code> Within-sample alternative allele frequency (<code>ad_alt / (ad_alt + ad_ref)</code>), where <code>ad_ref</code> and <code>ad_alt</code> are the depths of the reference and alternative allele. <p>For more information about variant calling, please see Understanding the Dashboard.</p>"},{"location":"output_files/#sharing-data","title":"Sharing data","text":"<p>The results folder for an experiment (<code>results/&lt;expt_name&gt;</code>) contains all the outputs from Nomadic. </p> <p>Only the CSV files starting <code>summary</code> and the <code>metadata</code> folder are required to relaunch the dashboard with the <code>nomadic dashboard</code> command (see Basic Usage).</p>"},{"location":"understand/","title":"Understanding the Dashboard","text":"<p>The Nomadic dashboard provides information about:</p> <ul> <li>Read mapping statistics</li> <li>Region (i.e. amplicon) coverage statistics</li> <li>Variant calling</li> </ul> <p>Each of these outputs has it's own panel in the dashboard, as is described in more detail below.</p>"},{"location":"understand/#read-mapping-statistics","title":"Read Mapping Statistics","text":"<p>The top panel in the dashboard shows information about read mapping. </p> <p>Note</p> <p>Read mapping is the process whereby sequencing reads are aligned to a reference genome based on sequence similarity. The objective of read mapping is to find the location in the reference genome from which a sequencing read likely originated. Sometimes, a single good alignment can be found for a read, but sometimes no good alignments, or multiple equally good alignments are found.</p> <p></p> <p>In Nomadic, information about read mapping is displayed in a stacked barplot. For each sequenced sample (x-axis), the total height of the bar is the number of alignments produced after all the reads from that sample were mapped. The colours in the stacked bar indicate the type of alignment that was generated for each read:</p> <ul> <li>Reads with only one unique alignment to the reference genome are shown in dark blue. These are called primary alignments, and are labeled <code>Primary</code>. These are the best for downstream analysis.</li> <li>Reads with no alignments to the reference genome are shown in grey. These are unmapped reads, and labeled <code>Unmapped</code>. This can happen if the read is too short or low quality to be accurately mapped, or derives from an organism other than the reference genome. With NOMADS-MVP, the unmapped reads typically represent offtarget amplification of the host genome.</li> <li>Reads with two or more alignments to the reference are labeled in the lighest shade of blue. These are called secondary alignments, are are labeled <code>Secondary</code>. These can occur when a sequencing read originates from a repetitive region of the genome.</li> <li>Reads that must be split in pieces to be aligned to the reference genome are shown in the middle shade of blue. These are called chimeric alignments, and are labeled <code>Supplementary</code>. These are usually caused by technical factors during library preparation of sequencing, but can also indicate structural varation.</li> </ul> <p>The pie chart at the left shows the overall read mapping distribution across all sequenced samples.</p> <p>Other points to note:</p> <ul> <li>In the y-axis labels, 'k' refers to thousands. So 10k = 10,000.</li> <li>If you are sequencing with NOMADS-MVP, lower parasitemia samples will have more unmapped reads (grey).</li> </ul>"},{"location":"understand/#region-coverage-statistics","title":"Region Coverage Statistics","text":"<p>The second panel of the dashboard shows information about the amount of coverage over your target regions. For amplicon sequencing, the target regions are defined by your amplicons. </p> <p>Note</p> <p>Coverage is a measure of the number of sequencing reads that 'cover' a given position of the genome. By position, we mean a single nucleotide in the genome. A read covers that position if, after read mapping, its alignment includes the position. The mean coverage over a region is the mean of the coverage of all the positions included in the region.</p> <p></p> <p>Nomadic shows this information as a scatter plot. For each sample (x-axis), a point will be drawn for each target region. The colour indicates the identity of the target region and there is a legend at the top of the plot. For example, in NOMADS-MVP, the pink points correspond to kelch13. The y-axis gives the mean coverage (<code>mean_cov</code>), number of reads (<code>n_reads</code>) or percentage of bases with greater than 100x coverage (<code>cov_gr100_per</code>), depending on what is selected in the drop down menu located above the pie chart.</p> <p>The pie chart aggregates information across all samples. In an ideal scenario, the slices of the pie will be close to equal, indicating that the different target regions have similar coverage. In practice, coverage can vary between targets due to differences in PCR efficiency. As long as the lowest abundance amplicon is still recieving sufficient coverage (typically 100x), this is not a major problem.</p>"},{"location":"understand/#identifying-candidate-hrp23-deletions-with-nomads-mvp","title":"Identifying candidate hrp2/3 deletions with NOMADS-MVP","text":"<p>You can use the 'Region Coverage Statistics' panel to identify candidate hrp2 and hrp3 deletions.</p>"},{"location":"understand/#preliminary-variant-calling","title":"Preliminary Variant Calling","text":"<p>The bottom panel of the dashboard shows information about variant calling. </p> <p></p> <p>Nomadic shows variant calling information as a heatmap for each target region. You can select different target regions using the drop down menu at the top left. In the heatmap, the samples are on the x-axis and the variants (i.e. mutations) are on the y-axis. The colour in each cell of the heatmap gives the within-sample alternative allele frequency (WSAF).</p> <p>Note</p> <p>The within-sample alternative allele frequency (WSAF) is the fraction of sequencing reads that carry the alternative allele (i.e. variant or mutation). It ranges from 0 to 1.</p> Colour WSAF Interpretation Conclusion Dark purple 0.0 None of the reads in the sample carry the mutation. The sample does not have the mutation. It is homozygous reference. Dark red 1.0 All of the reads in the sample carry the mutation. The sample does carry the mutation. It is homozygous alternative. Light blue, yellow, orange 0.0 &lt; WSAF &lt; 1.0 The WSAF is between 0 and 1. These means some, but not all, of the reads in the sample carry the mutation. For P. falciparum malaria, this indicates that the sample is polyclonal, and at least one clone has the mutation. The sample does carry the mutation. It is heterozygous alternative. White Not available This indicates that not enough sequencing reads have been collected for the sample to make a determination. Not enough data. Sample has failed or more sequencing time is required. <p>In the plot above shows the target ama1 for a set of control samples. The first three barcodes are 3D7, HB3 and Dd2. They are monoclonal, so all mutations are either dark purple (WSAF=0) or dark red (WSAF=1). After that, we have mixed strains together at different proportions, making them polyclonal, which leads to intermediate colours. The last three barcodes (46, 47, 48) are negative controls, hence they are the heatmap is white.</p>"}]}